
 REQUIRE  tabl_kalibr  ~disa/kalibr_hype.f
 REQUIRE  dBuV->V  ~disa/algoritm.f
 REQUIRE WildCMP-U ~pinka/lib/mask.f


 
	0 CONSTANT NoError
\ коды управления
	1 CONSTANT work_Execute   \ нормальный режим работы
	2 CONSTANT work_Stop   \  программа остановлена, ожидаем запуска
	3 CONSTANT work_End_Work   \  работа  закончилась ожидаем ответа оператора

	3 CONSTANT work_Pause   \ пауза
 
 
\ коды ошибок
	1001 CONSTANT error_begin_problem
	1002 CONSTANT error_end_problem
	1003 CONSTANT error_cicle_problem
	1004 CONSTANT error_metod_file
	1005 CONSTANT error_nastr_file
	2001 CONSTANT error_out_file  \ ошибки подключаемых файлов
	3001  CONSTANT  error_face \ ошибка данных в окне



\ набор для управления программой
	 0
	1024 -- Data_buffer \ буфер  для служебных выводимых на экран
	256  -- _file_name_bufer_ \ буфер  передачи имени между потоками
	256  -- ERROR_PROG_BUFER \ буфер  передачи ошибки
	CELL -- ERROR_PROG \ номер ошибки
	CELL -- work_thread \ запуск потока
	CELL -- tid-thead \ -  физическое управление потоком
	CELL -- -upravl_thead-  \ логический ключ для процедуры  запуска/останова  испытаний.. все удаления нужно делать в том же потоке, в котором и запускались
	CELL  -- _file_result_temp__ \ ИД временного файла результатов
	CELL -- refresh  \ обновление
\	CELL -- STEP_PAUSE
\	CELL -- STEP_TIME
	256 -- file_nastr_buf
	  CELL -- Len_Coment_buffer \ размер данных в буфере для коментария настроек
	  1024 -- Coment_buffer \ буфер  для коментария настроек
	
CONSTANT sysup-work-info  

0 VALUE vSTEP_PAUSE
0 VALUE vSTEP_TIME
0 VALUE vFREQ_BEGIN
0 VALUE vFREQ_END
0 VALUE vFREQ_STEP
0 VALUE vwork_step
0 VALUE vfile_kalibrov_buf
0 VALUE vfile_generator_buf
0 VALUE vfile_nastr_buf
0 VALUE vresult 
 
\ 0 VALUE vComent_buffer	\ буфер  для коментария настроек
0 VALUE vFREQ			\ текущая частота
0 VALUE vfile_result			\ файла результата

0 VALUE vgenerator
0 VALUE vkalibrovka
0 VALUE  vfile_kalibrov_korrect

0 VALUE sysup-metod-info  \ структура

\ изменяемые "вручную" значения
\ меняем данную структуру
\ в ней будут данные:\
\ адрес переменной
\ адрес следующей пременной
\ byte - тип элемента 1- целое 2-действительное 3 -текст 4- имя калибровки 5- имя файла прибора 6-число с множителем ( 0/кило/мега/гига/)
\ длинна описания переменной
\ XXX - описание переменной
\ XXX -место для переменной

\ обращение следующее:
\   "struct"   "name"   -  параметры переменной
\   "struct"  "name" 1 +   -  описание
\  "struct"  "name" 256 +   - переменная

: Add_sysup-metod-info { here adr u type len \  --  here }
		0 , 0 ,  type C, 0 C, \ адрес этой переменной, адрес следующей, тип переменной, длинна описания
		u  here CELL+ CELL+ 1 +   C!   \  длинна строки
		u 1 + ALLOT \  выделяем память для строки 
		adr here CELL+ CELL+ 2 + u  CMOVE \ и копируем строку в структуру	
		HERE len ALLOT \ выделяем память под переменную 
		here ! \ пишем в структуру адрес переменной
		here  \ для записи в именнованную переменную
;

: :save_next_sysup-metod-info  { here  } \ следующая переменная в структуре
DUP here CELL +  ! \  -> here
;

: Create_sysup-metod-info { \   adr u  here  info }
HERE  DUP -> here TO sysup-metod-info 
 
here S" Файл настроек"						4 256		Add_sysup-metod-info TO  vfile_nastr_buf	HERE here :save_next_sysup-metod-info -> here
here S" Пауза между воздействиями, мс"				1 1 CELLS	Add_sysup-metod-info TO  vSTEP_PAUSE		HERE here :save_next_sysup-metod-info -> here
here S" Время воздействия ,  мс"				1 1 CELLS	Add_sysup-metod-info TO  vSTEP_TIME		HERE here :save_next_sysup-metod-info -> here
here S" Частота начальная, Гц"					2 1 FLOATS	Add_sysup-metod-info TO  vFREQ_BEGIN		HERE here :save_next_sysup-metod-info -> here
here S" Частота конечная, Гц"					2 1 FLOATS	Add_sysup-metod-info TO  vFREQ_END		HERE here :save_next_sysup-metod-info -> here
here S" Шаг по частоте, Гц"					2 1 FLOATS	Add_sysup-metod-info TO  vFREQ_STEP		HERE here :save_next_sysup-metod-info -> here
here S" ТИП РАБОТЫ: (-1) - %, (0)-линейный, (1)-по таблице"	1 1 CELLS	Add_sysup-metod-info TO  vwork_step		HERE here :save_next_sysup-metod-info -> here
here S" Файл калибровки"					4 256		Add_sysup-metod-info TO  vfile_kalibrov_buf	HERE here :save_next_sysup-metod-info -> here
\ here S" Корректировка калибровки"				2  1 FLOATS	Add_sysup-metod-info TO  vfile_kalibrov_korrect	HERE here :save_next_sysup-metod-info -> here
here S" Файл генератора"					5 256		Add_sysup-metod-info TO  vfile_generator_buf	HERE here :save_next_sysup-metod-info -> here
here S" Частота установленная, Гц"				2 1 FLOATS	Add_sysup-metod-info TO  vFREQ			HERE here :save_next_sysup-metod-info -> here
here S" Файл результата"					3 256		Add_sysup-metod-info TO  vfile_result		HERE here :save_next_sysup-metod-info -> here
here S" Объект генератор"					1 1 CELLS	Add_sysup-metod-info TO  vgenerator		HERE here :save_next_sysup-metod-info -> here
here S" Объект калибровка"					1 1 CELLS	Add_sysup-metod-info TO  vkalibrovka		HERE here :save_next_sysup-metod-info -> here 
here S" файл результата"					1 1 CELLS	Add_sysup-metod-info TO vresult		\ HERE here :save_next_sysup-metod-info -> here 

;

: SeeOne \ подготовить в выводу описание переменной из настроек
	{ n \ i adr -- } ( n -- num/fnum  flag adr u    | flag )
	\ flag:   0 - нет описания 1 - целое 2-действительное 3- строка 4 -имя файла  калибровки, 5 -имя файла  прибора
	\ 6-  частота (МГц)
	\ ( если отричательные значения - нередактируемое поле)

\ ; 	  
\ : see_one  { adr  } \ vSTEP_PAUSE
\ CR ." see_name: " CR
\ adr  @ . CR     \ адрес переменной
\ adr CELL + @ . CR  \ адрес следующей
\ adr CELL +  CELL +  C@ . CR  \ тип переменной
\ adr CELL +  CELL +  1 + C@ . CR \ длинна описания
\ adr CELL +  CELL +  2 +   adr CELL +  CELL +  1 + C@  TYPE CR \ adr u  описание
\ CR ." :see_name " CR
0 -> i
 sysup-metod-info  -> adr
 BEGIN
 adr 
 n i <> AND  
 WHILE
\ adr see_one
 adr  CELL + @ -> adr  \ следующий адрес
  i 1 + -> i 
 REPEAT
 adr IF
	adr  @  
	  adr CELL +  CELL +  C@
	adr CELL +  CELL +  2 +   adr CELL +  CELL +  1 + C@   
 ELSE 0 THEN 
 ;

 

0 VALUE work-info \ минимальный набор дла запуска программы
\ 0 VALUE metod-info  \ дополнительные настроки программы, определяются в методе

 HERE DUP >R sysup-work-info DUP ALLOT ERASE TO work-info
\ HERE DUP >R sysup-metod-info DUP ALLOT ERASE TO  metod-info
 Create_sysup-metod-info
 
\ vSTEP_PAUSE see_one
\ vSTEP_PAUSE . CR
\ vSTEP_TIME . CR
\  CR CR 6 SeeOne .  CR CR
\ see_all

: To_Data_buffer   { adr u \  -- }
	work-info Data_buffer  @ 1 < IF 1024  0 DO 0 I work-info Data_buffer  + C! LOOP THEN \ очищение буфера
	work-info Data_buffer @ u + 1024 CELL -  > \ ограничение на буфер
	IF
		 1024 CELL - work-info Data_buffer @  -  -> u
	THEN
	adr work-info Data_buffer CELL+  work-info Data_buffer @ + u CMOVE 
	work-info Data_buffer @ u + work-info Data_buffer !
	 \ ."  ->" u . work-info Data_buffer @ . ." <- "
;

: Str_Data_buffer  ( -- s )
	work-info Data_buffer CELL+ work-info Data_buffer @ 
	  0 work-info Data_buffer  !
;


 : StoFile { s-adr   file }
	\  отправляю строку формата ~ас  в файл 
	   s-adr STR@ \  ." -> " TYPE ." <-"  \ SWAP textview_result_bufer @ 3 gtk_text_buffer_set_text DROP
	 To_Data_buffer  
	\        SWAP  textview_comment_bufer @ 3 gtk_text_buffer_set_text DROP
	s-adr   file  StoFile  
;

 : FtoFile { file } "  " file StoFile  >FNUM  STR>S file StoFile  "  " file StoFile  ; \ флоат число в выходной файл
 : DtoFile { file } "  " file StoFile   >NUM  STR>S file StoFile  "  " file StoFile  ; \ целое число в выходной файл
 : CRtoFile " {CRLF}" SWAP StoFile ;

 : COMMENT( { \ num  adr len  -- }
	0 -> num 
	BEGIN
		[CHAR] ) DUP PARSE   -> len -> adr 
		\    \ тут нужна защита от переполнения 
		adr  work-info Coment_buffer  num + len   CMOVE \ скопировали все в буфер
		num len + -> num		\ установили новый его размер
		adr len + C@ = 0=  
	WHILE
		REFILL 0= IF EXIT THEN
	REPEAT      
	work-info  Coment_buffer   num + 1+  0!
	num work-info   Len_Coment_buffer  !
 ;




: LOAD_TO_ERR_BUFER { s-adr adr \ u    -- }
	s-adr STR@ NIP  adr  C@ + 255 > IF 255  adr  C@ - ELSE  s-adr STR@ NIP  THEN -> u
	s-adr STR@ DROP  adr  1 + adr  C@ +  u CMOVE  
	s-adr STRFREE
	adr  C@   u + adr  C!
;


: TYPE_BUFER { bufer } 
	bufer  1+ 
	bufer  C@   DUP 0 > IF TYPE ELSE 2DROP ."  no info in buffer "  THEN 
;

: CLEAR_ERROR_BUFER 255 0 DO 0 work-info ERROR_PROG_BUFER   I + C!  LOOP  0 work-info  ERROR_PROG  ! ;
: TO_ERROR_PROG_BUFER    work-info ERROR_PROG_BUFER  LOAD_TO_ERR_BUFER ;  ( s-adr  ) \ ошибку в буфер
: TYPE_ERROR_PROG_BUFER  work-info ERROR_PROG_BUFER   TYPE_BUFER ;
\ отработка ошибки
: :ERROR  { s-adr-err n-err  }  s-adr-err  TO_ERROR_PROG_BUFER  n-err work-info  ERROR_PROG ! TYPE_ERROR_PROG_BUFER   -1 ;

: PAUSE-PROG 
	DUP 50 < 
	IF  PAUSE  
	ELSE 50 / 
		0 DO 
			work-info -upravl_thead- @  work_Execute = 
			work-info -upravl_thead- @  work_Pause = 
			OR
			IF  50 PAUSE THEN    
		LOOP 
	THEN 
;

\ : ->degree  \ freq, decimal -- freq2** 
 \ 10e  metod-info FREQ_DEGREE @   DS>F   F**  \ возвели в степень 
\ ;
 
\ отладочная информация


: SAVE_NASTR_DATA  { save_file \ NumFlag numadr adr u i } \ сохранение настроек CELL -- 
	" COMMENT( " save_file StoFile
	\	" 111111111222222222223333333333 " save_file StoFile
	\	"  ) " save_file StoFile save_file CRtoFile
	work-info Coment_buffer  work-info  Len_Coment_buffer @  \ данные по буферу
	STR>S  save_file StoFile   
	" )" save_file StoFile save_file CRtoFile

\	"  {''} " save_file StoFile  metod-info	STEP_TIME	@  save_file DtoFile  " {''} S>FLOAT DROP F>D DROP  metod-info STEP_TIME           ! "   save_file StoFile  save_file CRtoFile
\	"  {''} " save_file StoFile metod-info	file_generator_buf  1 +	metod-info	file_generator_buf	C@ STR>S save_file StoFile  " {''} metod-info file_generator_buf	LOAD_TO_BUFER " save_file StoFile  save_file CRtoFile

\ "  1000 " S>FLOAT DROP F>D DROP  metod-info STEP_TIME           ! 

 0   -> i   
BEGIN

 i SeeOne  \ ( n -- num/fnum  flag adr u    | flag )
 -> u
 u IF
	 -> adr -> NumFlag -> numadr
	NumFlag 1 =  \ целое
		IF  
			"  {''} " save_file  StoFile  
			numadr @  save_file DtoFile 
			" {''} S>FLOAT DROP F>D DROP " save_file StoFile
			i save_file DtoFile 
			" SeeOne  2DROP DROP ! " save_file StoFile
			"  \ " save_file  StoFile  
			adr u  STR>S save_file  StoFile  
			save_file CRtoFile 
		THEN
	NumFlag 2 =  \ действительное
		IF  
			"  {''} " save_file  StoFile  
			numadr F@  save_file FtoFile 
			" {''} S>FLOAT DROP " save_file StoFile
			i save_file DtoFile 
			" SeeOne  2DROP DROP F! " save_file StoFile
			"  \ " save_file  StoFile  
			adr u  STR>S save_file  StoFile  
			save_file CRtoFile 
		THEN
	NumFlag 2 >  NumFlag  6 <   AND  \ строка
		IF  
			"  {''} " save_file  StoFile  

			numadr  1 + numadr C@   STR>S  save_file StoFile \ строка
			"  {''}  " save_file  StoFile  

			i save_file DtoFile 
			" SeeOne  2DROP DROP  LOAD_TO_BUFER " save_file StoFile

			"  \ " save_file  StoFile  
			adr u  STR>S save_file  StoFile  
			save_file CRtoFile 
		THEN


 THEN
 i  1 + -> i
 u 0 =
UNTIL
;


	\
: IF_END:
	\ ." ifend "
	 vFREQ_STEP @ F@ 0e F>
	IF \ едем вверх
		vFREQ @ F@  vFREQ_END  @ F@ F>=    IF  vFREQ_END @   F@ vFREQ @ F! 
						0  ELSE 1 THEN
	ELSE \ едем вниз
		vFREQ @ F@ vFREQ_BEGIN @ F@ F<=    IF  vFREQ_BEGIN @ F@ vFREQ @ F!
						 0  ELSE 1 THEN
	THEN	

; 


: BEGIN:  
\	see
	."  include file_generator  " CR	   
	vfile_generator_buf @ DUP 1+ SWAP  C@  2DUP INCLUDE-PROBE IF " error in file generator " TO_ERROR_PROG_BUFER  -1 THROW THEN
	NewObj vgenerator @ !
	500 PAUSE
\ запуск устройств	
	."  start...   " CR	    
	 vfile_generator_buf	@  vgenerator @	@ ^ Start IF " generator not found " TO_ERROR_PROG_BUFER  -1 THROW THEN
	."  ...start  " CR	    
 
\	vFREQ_BEGIN @ F@ vgenerator @ @ ^ MinMax vFREQ_BEGIN @ F! 
\	vFREQ_END @   F@ vgenerator @ @ ^ MinMax vFREQ_END   @ F!  
\	 OR  DROP
	 \ IF " частота генератора. Поправлено. {CRLF} " vresult @ @  StoFile THEN 
\	vFREQ_BEGIN @ F@ vgenerator @ @ ^ MinMax vFREQ_BEGIN @ F! IF " минимальное  значение не соответствует генератору. Поправлено. {CRLF} " vresult @ @  StoFile THEN 

\	vFREQ_END @   F@ vgenerator @ @ ^ MinMax vFREQ_END   @ F!  
\		IF " частота генератора. Поправлено. {CRLF} "  vresult @ @  StoFile  \ 
\		" максимальное значение не соответствует генератору. поправлено. " vresult @ @  StoFile 
\		THEN
			\  IF " максимальное значение не соответствует генератору. Поправлено. {CRLF}"  vresult @ @  StoFile THEN 

	."  kalibrovka " CR	    
\ создали объект-основу калибровки
	500 PAUSE
	tabl_kalibr NewObj vkalibrovka @  !
	."  include kalibrovka  " CR	   

	vkalibrovka  @ @ 	vfile_kalibrov_buf  @ DUP  1+  SWAP C@   ERR-INCLUDE-PROBE 
		IF "  error_in_file_kalibrovka "  DUP STR@ TYPE TO_ERROR_PROG_BUFER  error_out_file  work-info  ERROR_PROG !
		ELSE ."  kalibrovka:  " vkalibrovka  @ @ ^ SeeDatas  THEN CR

	\ результаты	подготовили файл
	" .\result\result.txt"   outFileCreate vresult @ !
	\ устанавливаем мин и макс по калибровке, если они не соответствуют ей
	vFREQ_BEGIN @ F@  vkalibrovka  @ @ ^ MinMax vFREQ_BEGIN @ F! IF " минимальное  значение не соответствует калибровке. Поправлено. {CRLF} " vresult @ @  StoFile THEN 
	vFREQ_END @  F@  vkalibrovka  @ @ ^ MinMax vFREQ_END @  F! IF " максимальное значение не соответствует калибровке. Поправлено. {CRLF}" vresult @ @  StoFile THEN
	vFREQ_BEGIN @ F@ vFREQ @ F!  
	
	vFREQ_STEP @ F@ 0e F>
	IF \ едем вверх
	   vFREQ_BEGIN @ F@ vFREQ @ F!  
	ELSE \ едем вниз
	  vFREQ_END @ F@ vFREQ @ F!  
	THEN
	" start: " vresult @ @ StoFile TIME&DATE  DROP DROP DROP vresult @ @ DtoFile  vresult @ @ DtoFile  vresult @ @ DtoFile   vresult @  @  CRtoFile  
	" Частота,                ПОДАНО       "  vresult @ @ StoFile  vresult @ @ CRtoFile 
	." begin-ok"

; 

: WORK:     || F: gen F: kal  D: n_step   ||
	 \ уcтанавливаем частоту
	vFREQ @  F@    vgenerator	@ @ ^ SetFreq  
        vFREQ  @ F@ 2 vkalibrovka @ @ ^ TakeData  gen F!  \ начальные данные генератора

\ частота
	 vFREQ @ F@   vresult @ @ FtoFile  
	"               "  vresult @ @  StoFile

	gen F@  vgenerator @ @ ^ SetLevel  \  выставляем данные генератора
	vSTEP_TIME @ @ PAUSE-PROG
	 gen  F@   vresult @ @ FtoFile  
	"    "  vresult @ @  StoFile
\  калибровочные данные
	\ metod-info kalibr_izm	@ ^ GetLevel  DUP 0 >   IF   0 DO   metod-info result @ FtoFile  LOOP ELSE DROP    THEN
	 "    "  vresult @ @  StoFile  
	TIME&DATE  DROP DROP DROP vresult @ @ DtoFile  vresult @ @ DtoFile  vresult @ @ DtoFile 
		
	vresult @ @  CRtoFile  
	."  ...work "
	CR
; 




: END:  
	" stop: " vresult @ @  StoFile TIME&DATE  DROP DROP DROP vresult @ @  DtoFile  vresult @ @  DtoFile  vresult @ @  DtoFile   vresult @ @ CRtoFile  
	" Работа завершена"  vresult @ @  StoFile 
		vresult @ @ outFileClose
\ отключение оборудования
	vgenerator @	@ ^ Off
	vgenerator @	@ ^ Stop
 	\ metod-info kalibr_izm	@ ^ Stop
\ удаление оборудования 	
	vgenerator @	@  FreeObj
	\ metod-info kalibr_izm	@  FreeObj
\ удаление таблиц	
	vkalibrovka  @ @   FreeObj
	; 

	
: NewStep   
   	 vwork_step  @ @ 
	\  ."  v2 " DEPTH . FDEPTH . ."  " 
	 CASE 
		-1 OF  vFREQ_STEP  @ F@ 1e2 F/ vFREQ @  F@ F*   ( sign  IF -1e F* THEN)  vFREQ @  F@ F+    ENDOF
		1  OF  vFREQ  @ F@  vkalibrovka @ @ ^ NextFreq     ENDOF \ НЕ РАБОТАЕТ ПЕРЕБОР ВНИЗ по частоте!!!!! при табличной вводе
		vFREQ_STEP  @ F@   ( sign  IF -1e F* THEN) vFREQ  @ F@ F+  
	 ENDCASE
	vFREQ @ F!  

; 


 : WORK_END: 
    
 ;

\ один шаг по частоте
: WorkSteps
	work_Execute work-info -upravl_thead- !
	 \  work-info FREQ_BEGIN  F@ work-info  FREQ F!
	\ WORK_BEGIN:
	 BEGIN 
		\ ."  -1- "
		\ завершение работы, штатное/принудительное
		work-info  -upravl_thead- @ work_Execute = 
	\	work-info  -upravl_thead- @ work_Pause = 
	\	OR
		IF 
			IF_END:    \
		ELSE  0 
		THEN     
	WHILE
		\ рабочий цикл
		WORK:  
		\ вычисляем и запоминаем новый шаг (новую частоту?) 
		NewStep  \ work-info  FREQ  F!
	  	vSTEP_PAUSE @ @ PAUSE-PROG  
	REPEAT
		\ "последний" шаг
	work-info -upravl_thead- @ work_Execute = IF   WORK_END: WORK:      THEN     
;


: WorkCicle 
	\ обнулили ошибки при запуске
	CLEAR_ERROR_BUFER 
	NoError work-info ERROR_PROG !
	\ подготовка оборудования к запуску, инициализация приборов
	work_Execute work-info -upravl_thead- !
	[']  BEGIN: CATCH  
	IF \ CR  ." word BEGIN problem  " CR error_begin_problem work-info  ERROR_PROG !
		" word BEGIN problem  " error_end_problem  :ERROR  DROP
	ELSE \ если инициализация прошла 
		CR ." word BEGIN  - ok  " CR
		['] WorkSteps CATCH  
		IF   
			" word WorkCicle problem "  error_cicle_problem  :ERROR  DROP
			\	  error_cicle_problem work-info  ERROR_PROG ! 
		ELSE  CR ." word WorkCicle -ok  "  CR THEN
	THEN	
	['] END:  CATCH 	
	IF  \ CR ." word END problem. "  CR error_end_problem work-info  ERROR_PROG ! 
		" word END problem "  error_end_problem  :ERROR  DROP
	ELSE  CR ." word END - ok  " CR 
	THEN	
	\ metod-info result @ outFileClose
\	[']  FreePribor CATCH 0=  IF CR ." word FreePribor problem. " THEN	 
	work-info -upravl_thead- @ 0= \ если не было ошибок 
	IF  
		work_Stop  work-info -upravl_thead- ! \  то "нормальный" останов
	THEN
	\ 0 TO -work_thead-
	CR ." WorkCicle STOP" CR
	\ work_Stop  
	work_End_Work work-info -upravl_thead- !  \ ожидаем ответа оператора об завершении работы
	
	\ TERMINATE 
	
;




 : file_nastr_reqiured work-info file_nastr_buf 1+ work-info  file_nastr_buf C@  	INCLUDE-PROBE   ;


VARIABLE num_data \ номер последних/текущих данных в списке  gtk_tree... только для передачи внутри граф. интерфейса
VARIABLE dialog
\ VARIABLE dialog_file

\ окно метода
VARIABLE builder_metod
VARIABLE WinMetod
VARIABLE button_close_metod
VARIABLE WinMetod_timer \ для останова таймерра

VARIABLE treeview_metod_data
VARIABLE liststore_metod_text
VARIABLE button_save_data
VARIABLE tree_view_metod
VARIABLE filechooserbutton_file_nastr  \ настройки
VARIABLE filechooserbutton_metod 
VARIABLE button_save_data_metod
VARIABLE button_load_data_metod
VARIABLE filefilter_kal
VARIABLE filefilter_prib
VARIABLE filefilter_nast

VARIABLE  button_start
VARIABLE  button_stop
VARIABLE  button_pause
VARIABLE  textview_result 
VARIABLE  textview_result_bufer 


	 
\ диалог ввода цифр и файлов в методы  
VARIABLE button_norma
VARIABLE button_error 
VARIABLE dialog_entry
VARIABLE dialog_label
VARIABLE dialog_filechooserbutton 

\ различные итераторвы
 0 , HERE  64 ALLOT  VALUE iter_store_text
 0 , HERE  64 ALLOT  VALUE iter_n
 0 , HERE  64 ALLOT  VALUE iter_k


VARIABLE textview_comment_metod
VARIABLE textview_comment_bufer

VARIABLE dialog_end_work \ 


: Refresh_list { \ adr u I flag  s  data-adr }
	liststore_metod_text  @ 1 gtk_list_store_clear	 DROP
	0 -> I
	BEGIN
		I SeeOne  \ ."  SeeOne: " DUP . ." " 
		DUP  0 >  
	WHILE
		-> u -> adr   -> flag      -> data-adr  
		\ adr u TYPE ." -> " flag . CR
		I iter_store_text  liststore_metod_text  @  3 gtk_list_store_insert DROP
		\ -1  adr u STR>S DUP >R STR@ DROP 1 iter_store_text liststore_text  @ 5 gtk_list_store_set DROP R> STRFREE
		flag 1 =  \ целые
		IF 
			data-adr  @ >NUM  STR>S -> s 
		THEN
		flag 2 =  \ действительное
		IF 
			data-adr F@ >FNUM STR>S -> s 
		THEN
		flag 2 > flag 6 < AND 
		IF  \ строчки
			data-adr 1+ data-adr C@ STR>S -> s 
		THEN
		
		flag 6 = 
		IF \ частота с множителем 
			data-adr F@    \ ->degree F/ 
			>FNUM STR>S -> s 
		THEN

		flag 6 > flag 1 < OR 
		IF 
			"  закончено" -> s 
		THEN


		-1 I 0 adr u STR>S DUP >R STR@ DROP 1  s DUP >R STR@ DROP 2   iter_store_text liststore_metod_text  @ 9 gtk_list_store_set DROP R> STRFREE  R> STRFREE  
		I 1 + -> I
		\ ."  I: " I . ."  " CR
	REPEAT
	DROP
;

:NONAME 
	." but_stop_click"	
 \	0 work-info  ERROR_PROG  !	\ сбраcываем ошибки
	work_Stop work-info -upravl_thead- ! 	
	0 ;  1 CELLS  
CALLBACK: but_stop_click

:NONAME 
	0 DisableButon !
	0 WinMetod_timer !
	but_stop_click
	WinMetod @ 1 gtk_widget_destroy DROP  
	\	builder_metod @ 1 gtk_widget_destroy DROP  	
	0 ;  1 CELLS  
CALLBACK: on_metod_destroy  

:NONAME  
	WinMetod @ 1 gtk_widget_destroy DROP    
	\	builder_metod @ 1 gtk_widget_destroy DROP  	
	0 ;  1 CELLS  
CALLBACK: button_close_metod_click


\ диалог ввода параметров и процедура принятия решений
:NONAME     { \ flag  adr_str  adr u tekFile }
	num_data @ SeeOne \ адрес данных,тип данных,  название данных   длинна названия
	2DROP -> flag  -> adr_str  	
	\ выясняем какой тип  данных 
	." flag: " flag . CR 
	flag  1 =  flag  2 =   OR  flag  6 = OR \ действительное или  целое b
	IF  
		dialog_entry  @ 1 gtk_entry_get_text_length   DUP 0 > 
		IF 
			dialog_entry  @ 1 gtk_entry_get_text    -> adr  -> u \ adr u 	
			adr u  ."  NUMBER: "  TYPE ."  " 			
			adr u  STR>FLOAT    FDUP F. CR
			\	1000 PAUSE			
			IF
				flag  2 =  flag  6 = OR IF  adr_str F!  ELSE  F>D D>S  adr_str ! THEN \ действительное или целое
			ELSE FDROP -1 -> flag
			THEN 
\			CR DEPTH .   FDEPTH . CR
		ELSE DROP -1 -> flag 
\				CR  DEPTH . FDEPTH . CR 1000 PAUSE

		THEN
	THEN
	flag  3 =  \ строка
	IF
		dialog_entry  @ 1 gtk_entry_get_text_length   DUP 0 > 
		IF 
			dialog_entry  @ 1 gtk_entry_get_text     -> adr  -> u \ adr u 
			adr u STR>S adr_str LOAD_TO_BUFER	
		ELSE DROP -1 -> flag 
		THEN
		
	THEN
	flag  4 =  \ файл калибровки
	IF
		filefilter_kal @ dialog_filechooserbutton   @ 2 gtk_file_chooser_remove_filter DROP
		dialog_filechooserbutton @ 1 gtk_file_chooser_get_filename \  взяли имя
		DUP 
		IF 
			ASCIIZ> -> u  -> adr     
			adr u ?STR_FILE			\ проверили наличие файла
			IF     adr  u  STR>S adr_str LOAD_TO_BUFER		
			ELSE  -1 -> flag 
			THEN  
		ELSE DROP -1 -> flag 
		THEN
	THEN
	flag  5 =  \ файл оборудования
	IF
		filefilter_prib @ dialog_filechooserbutton   @ 2 gtk_file_chooser_remove_filter DROP
		dialog_filechooserbutton @ 1 gtk_file_chooser_get_filename \  взяли имя
		DUP 
		IF 
			ASCIIZ> -> u  -> adr     
			adr u ?STR_FILE			\ проверили наличие файла
			IF     adr  u  STR>S adr_str LOAD_TO_BUFER		
			ELSE  -1 -> flag 
			THEN  
		ELSE DROP -1 -> flag 
		THEN
	THEN
	dialog   @ 1 gtk_widget_hide DROP Refresh_list 
	dialog   @  ;  1 CELLS  
CALLBACK: button_norma_click

\ диалог ввода параметров кнопка отмены ввода
:NONAME 	
	dialog @  1 gtk_widget_hide DROP  
	0 ;  1 CELLS  
CALLBACK: button_error_click


:NONAME   {  column path tree_view \ model  flag  adr u  tekFile }
	." TreeView_start_metod_click"  CR
	dialog @  1 gtk_widget_show DROP
	\ выделенная строчка 
	  tree_view  1 gtk_tree_view_get_model   -> model 
	  path iter_store_text model 3   gtk_tree_model_get_iter DROP \ (model, &iter, path_string)
	  iter_store_text model 2 gtk_tree_model_get_string_from_iter    ASCIIZ> STR>S   \ STYPE ."  "
	   S>FLOAT 
	\ Временно 
	 IF 
		F>D D>S  num_data ! \ запомнить номер строчки с данными
		num_data @ SeeOne \ адрес данных,тип данных,  название данных   длинна названия
		-> u -> adr  -> flag
		adr u STR>S DUP >R  STR@ DROP dialog_label @ 2 gtk_label_set_text DROP R> STRFREE
		flag 1 = 
		IF 
			@  >NUM  STR>S   
		THEN	 \ целое
		flag 2 = 
		IF 
			F@ >FNUM  STR>S  
		THEN      \ действительное
		flag 3 = 
		IF 
			DUP 1+ SWAP C@ STR>S  
		THEN \ просто текст
		flag 4 = 
		IF  			\ имя файла калибровки
			DUP 1+ SWAP C@ STR>S 
			Directory   ASCIIZ>  "" DUP -> tekFile  STR+   " /default.kal" tekFile  S+ tekFile   STR@ ." Directory   " TYPE CR 
			tekFile    >R  R@ STR@  DROP dialog_filechooserbutton  @ 2 gtk_file_chooser_set_uri  R> STRFREE  ." dialog_filechooserbutton =" . CR 	
			filefilter_kal @ dialog_filechooserbutton   @ 2 gtk_file_chooser_add_filter DROP
			\	 DUP STR@ DROP dialog_filechooserbutton @ 2 gtk_file_chooser_set_filename DROP    
		
		THEN
		flag 5 = 
		IF  			\ имя файла прибора
			DUP 1+ SWAP C@ STR>S 
			" ./prib" -> tekFile    " /default.prib" tekFile  S+ tekFile   STR@ ." Directory   " TYPE CR 
			tekFile    >R  R@ STR@  DROP dialog_filechooserbutton  @ 2 gtk_file_chooser_set_uri  R> STRFREE  ." dialog_filechooserbutton =" . CR 	
			filefilter_prib @ dialog_filechooserbutton   @ 2 gtk_file_chooser_add_filter DROP
			\	 DUP STR@ DROP dialog_filechooserbutton @ 2 gtk_file_chooser_set_filename DROP    
		THEN
		flag 6 = 
		IF 
			F@    >FNUM  STR>S  
		THEN      \ частота 

		flag 6 > flag 1 < OR 
		IF 
			" ОШИБКА " 
		THEN
		DUP >R  STR@ DROP dialog_entry    @ 2 gtk_entry_set_text DROP R> STRFREE
	THEN
	column path tree_view 0 ; 3 CELLS 
CALLBACK:  TreeView_start_metod_click


: SaveDefaultNastrData { \ save_file tekFile  } 
\ синхронизация буфера настроек
	iter_n  textview_comment_bufer  @ 2 gtk_text_buffer_get_start_iter DROP
	iter_k  textview_comment_bufer  @ 2 gtk_text_buffer_get_end_iter DROP
	0 iter_k   iter_n    textview_comment_bufer  @ 4 gtk_text_buffer_get_text  ASCIIZ>   
	DUP work-info  Len_Coment_buffer ! \ запомнить длинну
	work-info  Coment_buffer SWAP CMOVE \ процесс перемещения 

	Directory   ASCIIZ>  "" DUP -> tekFile  STR+   
	" /default.nast" tekFile  S+   	
	tekFile  
	\ " 111.txt"
	outFileCreate ->  save_file
	save_file  SAVE_NASTR_DATA
	save_file outFileClose
;
		
:NONAME 
	SaveDefaultNastrData
	0 ;  1 CELLS  
CALLBACK: button_save_data_metod_click

\ загрузка начальных данныхдля работы
:NONAME 	
	0 work-info  ERROR_PROG  !	\ сбраcываем ошибки
	0 work-info  ERROR_PROG  !	\ сбраcываем ошибки
	\ грузим имя настроек
	filechooserbutton_file_nastr  @ 1 gtk_file_chooser_get_filename   DUP  ."  gtk_file_chooser_get_filename = " . CR
	DUP  
	IF  
		ASCIIZ> STR>S work-info  file_nastr_buf  LOAD_TO_BUFER  0
	ELSE 
		DROP "  Error: nastr not found "   error_metod_file :ERROR   
	THEN 
	IF EXIT THEN
\ грузим настройки
	file_nastr_reqiured 
	IF
		" Error: load nastr problem  "   error_metod_file :ERROR      
	THEN \ IF EXIT THEN
	\  ." DEPTH=" DEPTH .   CR 
	\ see CR
	\ metod-info  Len_Coment_buffer @ metod-info Coment_buffer  textview_comment_bufer @ 3 gtk_text_buffer_set_text DROP
	Refresh_list
	 0 ;  1 CELLS  
CALLBACK: button_load_data_metod_click   

:NONAME ." but_start_click"
	work_Execute work-info -upravl_thead- @ <> \  и запущенность программ, дабы не запускать 2 копии
	IF
		0 work-info  ERROR_PROG  !	\ сбраcываем ошибки
		\	S" " SWAP textview_result_bufer @  3 gtk_text_buffer_set_text DROP \ обнуляем окно
		\	load_data_out_form		\ подгружаем из формы данные
		work-info  ERROR_PROG @ 0=  \ проверяем на ошибки формы 
		IF	
			['] WorkCicle  TASK work-info work_thread !
			0 work-info work_thread @ START  
			 					
			   work-info tid-thead !
		THEN
	THEN
	Refresh_list
	 S" " SWAP textview_result_bufer @  3 gtk_text_buffer_set_text DROP \ обнуляем окно
	\	0 button_start @ 2 gtk_widget_set_sensitive DROP
	0 ;  1 CELLS  
CALLBACK: but_start_click

\ :NONAME
\ CALLBACK: dialog_end_work_destroy

:NONAME { \ s }
." ."
	Str_Data_buffer   STR>S -> s
	s STR@ NIP 
	IF   ."  >"  s STR@ TYPE ." <   " \ TYPE
\		S"  + " 
		s STR@   SWAP  textview_result_bufer @ 3 gtk_text_buffer_insert_at_cursor DROP 
	THEN
	s STRFREE
	\ вывод ошибки 
	work-info  ERROR_PROG @  NoError <> 
	IF 
		work-info ERROR_PROG_BUFER C@   work-info ERROR_PROG_BUFER 1+ textview_result_bufer @ 3 gtk_text_buffer_insert_at_cursor DROP  
		" {CRLF}" DUP  >R STR@ SWAP textview_result_bufer @ 3 gtk_text_buffer_insert_at_cursor DROP R> STRFREE
		work_Stop  work-info -upravl_thead- ! 
		CLEAR_ERROR_BUFER
	THEN
	
	work-info -upravl_thead- @    work_Execute = \  2DUP . .   \ работает?
	work-info -upravl_thead- @    work_Pause  = \  2DUP . .    | пауза
	OR 
	IF 
		0 button_start @ 2 gtk_widget_set_sensitive DROP
		1 button_stop @ 2 gtk_widget_set_sensitive DROP
		1 button_pause @ 2 gtk_widget_set_sensitive DROP
		\ work-info tid-thead   @ SUSPEND  work_Pause   work-info -upravl_thead- !
	THEN \ в стопе  
	
	work-info -upravl_thead- @    work_Stop  = \  2DUP . .    | стоп
	IF
\		work_Execute  work-info -upravl_thead- !   work-info tid-thead  @ RESUME  
		\ -upravl_thead- work_Pause = IF -work_thead-   RESUME  work_Execute  TO -upravl_thead-   ELSE  -work_thead-  SUSPEND  work_Pause  TO -upravl_thead- THEN 
		1 button_start @ 2 gtk_widget_set_sensitive DROP
		0 button_stop @ 2 gtk_widget_set_sensitive DROP
		0 button_pause @ 2 gtk_widget_set_sensitive DROP
			\ Вызвать dialog_end_work !!!

	THEN	
	
	work-info -upravl_thead- @    work_End_Work = \  2DUP . .    | программа завершила работу
	IF
\		" dialog_end_work"  >R R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object dialog_end_work !  R> STRFREE \ 2DROP
\		dialog_end_work @  1 gtk_widget_show DROP \ DROP
\ dialog = gtk_file_chooser_dialog_new ("Save File",
\                                      parent_window,
\                                      GTK_FILE_CHOOSER_ACTION_SAVE,
\                                      GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL,
\                                      GTK_STOCK_SAVE, GTK_RESPONSE_ACCEPT,
\                                      NULL);
\ 0 0 0 0 0 0 

		work_Stop work-info -upravl_thead- !       \  2DUP . .    | стоп
\ dialog_end_work_destroy
\	" destroy"  >R 0 0 0  ['] on_dialog_end_work_destroy  R@ STR@ DROP WinMetod @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP	
\	" button_close" >R  R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object button_close_metod  !    R> STRFREE \ 2DROP
	THEN	

	textview_result_bufer @  1 gtk_text_buffer_get_insert -> s
	0 0 0 0 s textview_result @ 6 gtk_text_view_scroll_to_mark DROP
	
	filechooserbutton_file_nastr  @   1 gtk_file_chooser_get_current_folder DUP 
	0<> 
	IF 
		DROP	\ ASCIIZ> TYPE 
	ELSE 
		DROP 	   " ./metod/GenOnly/" >R  R@ STR@  DROP filechooserbutton_file_nastr  @ 2 gtk_file_chooser_set_current_folder   R> STRFREE   ." filechooserbutton_pribor =" . CR	
	THEN

	dialog_filechooserbutton  @   1 gtk_file_chooser_get_current_folder DUP 
	0<> 
	IF 
		DROP	\ ASCIIZ> TYPE 
	ELSE 
		DROP 	   " ./metod/GenOnly/" >R  R@ STR@  DROP dialog_filechooserbutton  @ 2 gtk_file_chooser_set_current_folder   R> STRFREE   ." filechooserbutton_pribor =" . CR	
	THEN
	
	Refresh_list
	WinMetod_timer @  ;  1 CELLS  
CALLBACK:  timer_ticket 


:NONAME  ." but_pause_click"	
	 work-info -upravl_thead- @  work_Execute =  \ работает?
	IF 
		work-info tid-thead   @  SUSPEND  
		work_Pause   work-info -upravl_thead- !

	ELSE \ в паузе
		work_Execute  work-info -upravl_thead- !   
		work-info tid-thead  @   RESUME  
		\ -upravl_thead- work_Pause = IF -work_thead-   RESUME  work_Execute  TO -upravl_thead-   ELSE  -work_thead-  SUSPEND  work_Pause  TO -upravl_thead- THEN 
	THEN	
	0 ;  1 CELLS  
CALLBACK: but_pause_click


: StartMetod  {   \ tekFile }
	Directory 2 + ASCIIZ>  "" DUP -> tekFile  STR+
	" /metod.glade" tekFile  S+
	." load glade file :" tekFile     STR@ TYPE ."  " CR
	0 gtk_builder_new   builder_metod !
	error  tekFile   >R R@ STR@  DROP  builder_metod @ 3 gtk_builder_add_from_file DROP   R> STRFREE \ 2DROP 
	" winmetod"  >R R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object WinMetod !  R> STRFREE \ 2DROP
	WinMetod @  1 gtk_widget_show DROP \ DROP
	\ ДЕЙСТВО ЗАКРЫТИЕ ПРОГРАММЫ
	" destroy"  >R 0 0 0  ['] on_metod_destroy  R@ STR@ DROP WinMetod @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP	
	" button_close" >R  R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object button_close_metod  !    R> STRFREE \ 2DROP
	" clicked"  >R 0 0 0  ['] button_close_metod_click R@ STR@ DROP button_close_metod   @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP

	" treeview_data" >R  R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object  treeview_metod_data  !    R> STRFREE
	" row-activated"    >R 0 0 0  ['] TreeView_start_metod_click R@ STR@ DROP treeview_metod_data @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP

	" filefilter_kal" >R  R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object  filefilter_kal  !    R> STRFREE

 
	\ кнопка сохранить настройки
	" button_save_data_metod" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object button_save_data_metod !    R> STRFREE \ 2DROP
	" clicked"  >R 0 0 0  ['] button_save_data_metod_click   R@ STR@ DROP button_save_data_metod  @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP
	\  кнопка загрузить метод
	  " button_load_data_metod" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object button_load_data_metod !    R> STRFREE \ 2DROP
	" clicked"  >R 0 0 0  ['] button_load_data_metod_click   R@ STR@ DROP button_load_data_metod @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP
	 
 
	" liststore_text" >R R@ STR@ DROP builder_metod @ 2 gtk_builder_get_object liststore_metod_text ! R> STRFREE  
	
	\ " button_save_data" >R  R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object button_save_data  !    R> STRFREE \ 2DROP
	\  " clicked"  >R 0 0 0  ['] button_save_data_click R@ STR@ DROP button_save_data   @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP

	\ указатель для загрузки и  сохранении настроек
	 " filechooserbutton_file_nastr" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object filechooserbutton_file_nastr !    R> STRFREE \ 2DROP
	
	\ фильтры выбора файлов
	" filefilter_nast" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object filefilter_nast  !    R> STRFREE \ 2DROP
	" filefilter_prib" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object filefilter_prib  !    R> STRFREE \ 2DROP
	" filefilter_kal"  >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object filefilter_kal  !    R> STRFREE \ 2DROP

	\ устанавливаем фильтр для настроек
	filefilter_nast @ filechooserbutton_file_nastr   @ 2 gtk_file_chooser_add_filter DROP

	Directory   ASCIIZ>  "" DUP -> tekFile  STR+   " /default.nast" tekFile  S+ tekFile   
	>R  R@ STR@  DROP filechooserbutton_file_nastr  @ 2 gtk_file_chooser_set_uri  R> STRFREE  ." gtk_file_chooser_set_uri =" . CR 

	\ коментарий наксктоек
	" textview_comment_metod" >R  R@ STR@  DROP builder_metod  @  2 gtk_builder_get_object textview_comment_metod !    R> STRFREE 
	textview_comment_metod @ 1 gtk_text_view_get_buffer textview_comment_bufer ! 

	\ кнопка старт
	" button_start" >R  R@ STR@  DROP builder_metod  @ 2 gtk_builder_get_object button_start !    R> STRFREE \ 2DROP
	" clicked"  >R 0 0 0  ['] but_start_click   R@ STR@ DROP button_start @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP
	\ кнопка стоп
	" button_stop" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object button_stop !    R> STRFREE \ 2DROP
	" clicked"  >R 0 0 0  ['] but_stop_click   R@ STR@ DROP button_stop @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP
	\ кнопка пауза
	" button_pause" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object button_pause !    R> STRFREE \ 2DROP
	" clicked"  >R 0 0 0  ['] but_pause_click   R@ STR@ DROP button_pause @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP

	" textview_result" >R  R@ STR@  DROP builder_metod  @  2 gtk_builder_get_object  textview_result !    R> STRFREE 
	textview_result @ 1 gtk_text_view_get_buffer  textview_result_bufer ! 

	\ button_load_data_metod_click \ ЗАГРУЗКА ПОСЛЕДНИХ ДАННЫХ

	\ поднятие диалога выбора  вот тут проблемма что если удалять и включать. то  втором и последующих включениях появляетя голое окно без кнопочек.
	 " dialog_label" >R  R@ STR@  DROP builder_metod @ 2 gtk_builder_get_object dialog_label !    R> STRFREE \ изменяемая надпись
	
	 " dialog"  DUP >R STR@  DROP builder_metod @ 2 gtk_builder_get_object  dialog !  R> STRFREE \ 2DROP
	 " button_norma" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object button_norma !    R> STRFREE \ 2DROP
	 " clicked"  >R 0 0 0  ['] button_norma_click   R@ STR@ DROP button_norma @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP
	 " button_error" >R  R@ STR@  DROP builder_metod @  2 gtk_builder_get_object button_error !    R> STRFREE \ 2DROP
	 " clicked"  >R 0 0 0  ['] button_error_click   R@ STR@ DROP button_error @ 6 g_signal_connect_data   R> STRFREE  DROP \ 2DROP 2DROP 2DROP
	 " dialog_entry" >R  R@ STR@  DROP builder_metod  @ 2 gtk_builder_get_object dialog_entry !    R> STRFREE \ 2DROP
	 " dialog_filechooserbutton"  >R  R@ STR@  DROP builder_metod   @  2 gtk_builder_get_object dialog_filechooserbutton !    R> STRFREE \ 2DROP
	 dialog @  1 gtk_widget_hide DROP 

	1 WinMetod_timer !
	 0 ['] timer_ticket  1000 3 g_timeout_add DROP
 
	1 button_start @ 2 gtk_widget_set_sensitive DROP
	0 button_stop @ 2 gtk_widget_set_sensitive DROP
	0 button_pause @ 2 gtk_widget_set_sensitive DROP
;




StartMetod
Refresh_list